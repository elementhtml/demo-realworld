<meta is="e-remote" :="tags << $.value.tags << ${~api}/tags" content-type="json">
<meta is="e-dom"
    :='tags >> {"<a.tag-pill.tag-default>": [$map($, function($t) {{"@href": "", "..": $t}})]} >> :|.tag-list'>
<meta is="e-dom" :='user >> {
    "`#feed-renderer`": {
        "@data-endpoint": $.username ? "articles/feed" : "articles", 
        "@:": $find("#feed-renderer").`@data-directive-template`    
    }, 
    "`.feed-toggle`": {
        "`.nav-item:first-of-type a`": {"&active": $.username}, 
        "`.nav-item:last-of-type a`": {"&active": $not($.username)}
    }
} >> |'>
<meta is="e-dom" :='articlesEndpoint << $.`@href` << |.feed-toggle a' prevent passive>
<meta is="e-dom" :='articlesEndpoint >> {
        "`|.article-list`": {"<p>": "Loading articles..."}, 
        "@data-endpoint": $, "refresh()": "@data-directive-template", 
        "`|.feed-toggle`": {
            "`.nav-item:first-of-type a`": {"&active": $ = "articles/feed" }, 
            "`.nav-item:last-of-type a`": {"&active": $ = "articles" }    
        }
    } >> #feed-renderer'>
<meta is="e-remote" data-directive-template='{feed, pagination} << 
    ($cell.key = "feed" ? $.value.articles : { "count": $.value.articlesCount, "offset": ${@data-offset}, "limit": ${@data-limit} }) 
        << ${~api}/${@data-endpoint}?limit=${@data-limit}&offset=${@data-offset}' content-type="json" options='${~get}'
    data-endpoint="articles" data-limit="10" data-offset="0" id="feed-renderer">
<meta is="e-dom" :='feed >> $count($) ? {"<%#feed-article-preview%>": [$map($, function($a) {{
    "`.article-meta`": { 
        "`[href]{}`": {"@href": "#/profile/" & $a.author.username}, 
        "`img`": {"@src": $a.author.image}, 
        "`.author`": {"@href": "#/profile/" & $a.author.username, "..": $a.author.username}, 
        "`.date`": $fromMillis($toMillis($a.createdAt), "[MNn] [D1o]"), 
        "`.favorites-count`": $a.favoritesCount
    }, 
    "`.preview-link`": {
        "@href": "#/article/" & $a.slug,
        "`h1`": $a.title, 
        "`p`": $a.description, 
        "`.tag-list`": {"<li.tag-default.tag-pill.tag-outline>": $map($a.tagList, function($t) { $t })}
    }
}})]} : {"<p>": "You have no articles in your feed!"} >> |.article-list'>
<meta is="e-dom" :='pagination >> {"<li.page-item>": $.count ? [$map([1..$ceil($.count/$.limit)], function($n) { ($offset := (($n-1) * $.limit) ; {
    "&active": ($offset = $.offset), 
    "<a.page-link>": { "..": $n, "@data-offset": $offset, "@data-limit": $.limit, "@href": "?offset=" & $offset & "&limit=" & $.limit } 
})})] : [] } >> |.pagination'>
<meta is="e-dom" :='currentPage << { "offset": $.`@data-offset`, "limit": $.`@data-limit` } << |.pagination li a'
    prevent>
<meta is="e-dom" :='currentPage >> {
    "`|.article-list`": {"<p>": "Loading articles..."}, 
    "@data-limit": $.limit, "@data-offset": $.offset, "refresh()": "@data-directive-template"
} >> #feed-renderer' prevent>

<template id="feed-article-preview">
    <div class="article-preview">
        <div class="article-meta">
            <a href><img src /></a>
            <div class="info">
                <a href class="author"></a>
                <span class="date"></span>
            </div>
            <button class="btn btn-outline-primary btn-sm pull-xs-right">
                <i class="ion-heart"></i> <span class="favorites-count"></span>
            </button>
        </div>
        <a href class="preview-link">
            <h1></h1>
            <p></p>
            <span>Read more...</span>
            <ul class="tag-list"></ul>
        </a>
    </div>
</template>

<div class="home-page">
    <div class="banner">
        <div class="container">
            <h1 class="logo-font">conduit</h1>
            <p>A place to share your knowledge.</p>
        </div>
    </div>
    <div class="container page">
        <div class="row">
            <div class="col-md-9">
                <div class="feed-toggle">
                    <ul class="nav nav-pills outline-active">
                        <li class="nav-item">
                            <a class="nav-link" href="articles/feed">Your Feed</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="articles">Global Feed</a>
                        </li>
                    </ul>
                </div>
                <div class="article-list">
                    <p>Loading articles...</p>
                </div>
                <ul class="pagination"></ul>
            </div>
            <div class="col-md-3">
                <div class="sidebar">
                    <p>Popular Tags</p>
                    <div class="tag-list"></div>
                </div>
            </div>
        </div>
    </div>
</div>