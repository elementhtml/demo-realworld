<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ElementHTML â€¢ RealWorld</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//code.ionicframework.com" crossorigin>
    <link rel="preconnect" href="//demo.productionready.io" crossorigin>

    <link rel="preload" as="style"
        href="//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic&display=swap">
    <link rel="preload" as="style" href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="preload" as="style" href="//demo.productionready.io/main.css">
    <link rel="preload" as="style" href="theme/dark.css">

    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css" />
    <link
        href="//fonts.googleapis.com/css?family=Titillium+Web:700|Source+Serif+Pro:400,700|Merriweather+Sans:400,700|Source+Sans+Pro:400,300,600,700,300italic,400italic,600italic,700italic&display=swap"
        rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//demo.productionready.io/main.css" />
    <link rel="stylesheet" href="theme/dark.css" />

    <script type="importmap">
        {
            "imports": {
                "rw": "./packages/rw.js"
            }
        }
    </script>
    <script type="module" src='../element/element.js?load&expose&packages=rw'></script>
    <!-- <script type="module"
        src='https://cdn.jsdelivr.net/gh/elementhtml/element@8aca9f1a13c3230a1b607d06f2e1675a24f54069/element.js?load&expose&packages=rw'></script> -->

    <meta is="e-proxy" :="user << $ << store`localStorage.getItem('user')`" content-type="json">
    <meta is="e-proxy" :="user >> $ >> store`localStorage.setItem('user', $)`" content-type="json">

    <meta is="e-dom" :='user >> `transforms/mainnav.jsonata` >> #mainnav'>

    <meta is="e-dom"
        :='currentSection << ( $section := $substringBefore($substring($, 1), "/") ; $section ? $section : "home" ) << #'>

    <meta is="e-remote" :='template << ( $response.ok ? $ : $404) << templates/${#currentSection}.html'>
    <meta is="e-dom" :='template >> {"<>": $} >> :|main'>

    <meta is="e-remote" :='{feed, pagination} << 
    ($key = "feed" ? $.articles : { "count": $.articlesCount, "offset": ${@data-offset}, "limit": ${@data-limit} }) 
        << ${~api}/${@data-endpoint}?limit=${@data-limit}&offset=${@data-offset}${@data-filter}${@data-tag}'
        content-type="json" options='${~get}' data-filter="&" data-tag="&" data-limit="10" data-offset="0"
        id="feed-renderer">

    <meta is="e-dom" :='feed >> $count($) ? {"<%#feed-article-preview%>": [$map($, function($a) {{
        "#": $a.slug, 
        "`.article-meta`": { 
            "`[href]{}`": {"@href": "#/profile/" & $a.author.username}, "`img`": {"@src": $a.author.image}, 
            "`.author`": {"@href": "#/profile/" & $a.author.username, "..": $a.author.username}, 
            "`.date`": $fromMillis($toMillis($a.createdAt), "[MNn] [D1o]"), "`.favorites-count`": $a.favoritesCount
        }, 
        "`.preview-link`": {
            "@href": "#/article/" & $a.slug, "`h1`": $a.title, "`p`": $a.description, 
            "`.tag-list`": {"<li.tag-default.tag-pill.tag-outline>": $map($a.tagList, function($t) { $t })}
        }
    }})]} : {"<p>": "No articles in this feed..."} >> :|.article-list'>
    <meta is="e-dom" :='pagination >> {"<li.page-item>": $.count ? [$map([1..$ceil($.count/$.limit)], function($n) { ($offset := (($n-1) * $.limit) ; {
        "&active": ($offset = $.offset), 
        "<a.page-link>": { "..": $n, "@data-offset": $offset, "@data-limit": $.limit, "@href": "?offset=" & $offset & "&limit=" & $.limit } 
    })})] : [] } >> :|.pagination'>

    <meta is="e-dom" :='currentPage << { "offset": $.`@data-offset`, "limit": $.`@data-limit` } << :|.pagination li a'>
    <meta is="e-dom" :='currentPage >> {
        "`:|.article-list`": {"<p>": "Loading articles..."}, "@data-limit": $.limit, "@data-offset": $.offset
    } >> #feed-renderer'>

    <meta is="e-dom" :="tag << $.textContent << :|.tag-list a">
    <meta is="e-dom" :='tag >> {
        "`:|.feed-toggle`": {"`li{}`": {"`a`": {"&active": false}}, "`li:nth-of-type(3)`": {"^display": null, "`a`": {"&active": true, "..": "#" & $} } }, 
        "`:|.article-list`": {"<p>": "Loading articles..."}, "`:|.pagination`": {"..": ""}, "@data-tag": "&tag=" & $, "@data-offset": "0"
    } >> #feed-renderer'>

    <meta is="e-dom"
        :='articleToFavorite << $seek(".article-preview|").id << :|.article-preview .btn-outline-primary,.article-preview .btn-outline-primary *'
        passive>
    <meta is="e-remote" :="articleToFavorite >> $ >> ${~api}/articles/${#articleToFavorite}/favorite" options="${~post}"
        content-type="json">

    <template id="feed-article-preview">
        <div class="article-preview">
            <div class="article-meta">
                <a href><img src /></a>
                <div class="info">
                    <a href class="author"></a>
                    <span class="date"></span>
                </div>
                <button class="btn btn-outline-primary btn-sm pull-xs-right">
                    <i class="ion-heart"></i> <span class="favorites-count"></span>
                </button>
            </div>
            <a href class="preview-link">
                <h1></h1>
                <p></p>
                <span>Read more...</span>
                <ul class="tag-list"></ul>
            </a>
        </div>
    </template>

</head>

<body>
    <header>
        <nav class="navbar navbar-light">
            <div class="container">
                <a class="navbar-brand" href="./">conduit</a>
                <ul class="nav navbar-nav pull-xs-right" id="mainnav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/login"></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/register"></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/editor"></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/settings"></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#/profile/"></a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main></main>

    <footer>
        <div class="container">
            <a href="./" class="logo-font">conduit</a>
            <span class="attribution">
                An interactive learning project from <a href="https://thinkster.io">Thinkster</a>. Code &amp;
                design licensed under MIT.
            </span>
        </div>
    </footer>
</body>

</html>